<!--一颗可以根据节点数调整宽度的树-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body, html {
            width: 100%;
            height: 100%;
        }

        .container {
            width: 100%;
            height: 100%;
            border: 1px solid black;
        }

        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <div class="container">
        <canvas width="800" height="600"></canvas>
    </div>
</body>
<script>
    let canvas = document.querySelector('canvas');
    let ctx = canvas.getContext('2d');

    let data_lst = [
        {
            value: '1',
            children: [
                {
                    value: '2',
                    children: [
                        {
                            value: '5',
                        },
                        {
                            value: '6',
                        }
                    ]
                },
                {
                    value: '3',
                    children: [
                        {
                            value: '7',
                        }
                    ]
                },
                {
                    value: '4',
                    children: [
                        {
                            value: '8',
                        },
                        {
                            value: '9',
                        }
                    ]
                }
            ]
        }
    ];

    class AutoWidthTree {
        constructor(data_lst = [], canvas, opt) {
            let d_opt = {
                min_width: 50,
            };

            this.data_lst = data_lst;
            this.canvas = canvas;
            this.ctx = this.canvas.getContext('2d');
            this.opt = Object.assign(d_opt, opt || {});
            this._transformData(this.data_lst);
            this._drawTree(this.data_lst, this.opt);
        }

        _transformData(lst) {
            let width = 0;

            for (var obj of lst) {
                let tmp_width = 0;

                if (obj.children) {
                    tmp_width = this._transformData(obj.children);
                }
                else {
                    tmp_width = 1;
                }

                obj.width = tmp_width;
                width += tmp_width;
            }

            return width;
        }

        _drawTree(lst, opt) {

        }

        _drawPoint(obj) {
            this.ctx.beginPath();
            this.ctx.fillStyle = 'yellow';
            this.ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
            this.ctx.fill();
            this.ctx.closePath();
        }

        _drawLine(obj) {
            this.ctx.beginPath();
            this.ctx.fillStyle = 'black';
            this.ctx.moveTo(obj.s_pos.x, obj.s_pos.y);
            this.ctx.lineTo(obj.e_pos.x, obj.e_pos.y);
            this.ctx.closePath();
        }
    }

    function drawArrowLine(ctx, s_pos, e_pos) {
        ctx.beginPath();
        ctx.fillStyle = 'black';
        ctx.moveTo(s_pos.x, s_pos.y);
        ctx.lineTo(e_pos.s, e_pos.y);
        ctx.fill();
        ctx.closePath();

        let obj = calculateArrowAngle(s_pos, e_pos);
        ctx.beginPath();
        ctx.moveTo(e_pos.s, e_pos.y);
        ctx.lineTo(obj.p1.x, obj.p1.y);
        ctx.fill();
        ctx.closePath();

        ctx.beginPath();
        ctx.moveTo(e_pos.s, e_pos.y);
        ctx.lineTo(obj.p2.x, obj.p2.y);
        ctx.fill();
        ctx.closePath();
    }

    function calculateArrowAngle(s_pos, e_pos, angle = 30, length = 20) {
        let angle1 = calcAngleDegrees(e_pos.x - s_pos.x, e_pos.y - s_pos.y);
        let angle2 = angle1 + angle;
        let angle3 = angle1 - angle;

        let x1 = Math.sin(angle2) * length;
        let y1 = Math.cos(angle2) * length;
        let x2 = Math.sin(angle3) * length;
        let y2 = Math.cos(angle3) * length;

        return {
            p1: {
                x: x1,
                y: y1,
            },
            p2: {
                x: x2,
                y: y2,
            }
        }
    }

    function calcAngleDegrees(x, y) {
        return Math.atan2(y, x) * 180 / Math.PI;
    }

</script>
</html>
